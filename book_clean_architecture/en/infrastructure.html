<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 4: Infrastructure Layer - Clean Architecture</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;800&family=Merriweather:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; color: #1e293b; }
        h1, h2, h3, h4 { color: #0f172a; font-weight: 800; letter-spacing: -0.025em; }
        p, li { font-family: 'Merriweather', serif; line-height: 1.8; color: #334155; margin-bottom: 1em; }
        
        .sidebar { background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%); border-right: 1px solid #334155; height: 100vh; position: fixed; width: 18rem; overflow-y: auto; z-index: 50; }
        .sidebar-title { color: #f8fafc; }
        .sidebar-subtitle { color: #60a5fa; }
        .nav-section { color: #94a3b8; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; padding: 1rem 1rem 0.5rem; }
        .nav-link { display: block; padding: 0.6rem 1rem; color: #94a3b8; font-weight: 500; font-size: 0.875rem; transition: all 0.2s; border-left: 3px solid transparent; text-decoration: none; }
        .nav-link:hover { background: rgba(255,255,255,0.05); color: #f1f5f9; border-left-color: #475569; }
        .nav-link.active { background: rgba(59, 130, 246, 0.1); color: #60a5fa; border-left-color: #3b82f6; }

        /* Code Styling */
        pre {
            font-family: 'JetBrains Mono', monospace;
            background-color: #1e293b;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 0.75rem;
            overflow-x: auto;
            font-size: 0.85rem;
            line-height: 1.6;
            border: 1px solid #334155;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin: 1.5rem 0;
        }
        .code-comment { color: #475569; font-style: normal; font-weight: 700; }
        .code-keyword { color: #c084fc; font-weight: bold; } 
        .code-class { color: #fbbf24; font-weight: bold; }   
        .code-func { color: #60a5fa; font-weight: bold; }    
        .code-str { color: #a3e635; }                        
        .code-dec { color: #f472b6; } 

        .badge { display: inline-flex; align-items: center; padding: 0.125rem 0.625rem; border-radius: 9999px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; margin-right: 0.5rem; }
        .badge-blue { background-color: #dbeafe; color: #1e40af; }
        .badge-red { background-color: #fee2e2; color: #b91c1c; }
        .badge-yellow { background-color: #fef9c3; color: #854d0e; }
        
        .card { background: white; border-radius: 1rem; padding: 2.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 2rem; border: 1px solid #e2e8f0; }
        
        details > summary { list-style: none; cursor: pointer; font-weight: 700; color: #2563eb; outline: none; padding: 1rem; background: #f8fafc; border-radius: 0.5rem; margin-bottom: 0.5rem; border: 1px solid #e2e8f0; }
        details[open] > summary { border-bottom-left-radius: 0; border-bottom-right-radius: 0; margin-bottom: 0; background: #eff6ff; }
        details > div { padding: 1.5rem; border: 1px solid #e2e8f0; border-top: 0; border-bottom-left-radius: 0.5rem; border-bottom-right-radius: 0.5rem; background: #fff; }
    </style>
</head>
<body class="flex bg-slate-50">

    <!-- SIDEBAR -->
    <aside class="sidebar hidden md:block">
        <div class="p-6 border-b border-gray-700">
            <h1 class="text-xl font-bold sidebar-title">Clean Architecture</h1>
            <span class="sidebar-subtitle text-sm">Author: Alex | InkyWorld</span>
        </div>
        <nav class="py-4">
            <div class="px-4 mb-4">
                <div class="flex gap-2 text-xs font-bold text-slate-400">
                    <a href="../ru/infrastructure.html" class="hover:text-white transition">RU</a>
                    <span class="text-slate-600">|</span>
                    <a href="infrastructure.html" class="text-blue-400 font-bold">EN</a>
                    <span class="text-slate-600">|</span>
                    <a href="../ua/infrastructure.html" class="hover:text-white transition">UA</a>
                </div>
            </div>

            <div class="nav-section">Fundamentals</div>
            <a href="index.html" class="nav-link">ğŸ“˜ Introduction</a>
            <a href="solid.html" class="nav-link">ğŸ“ SOLID Principles</a>
            <a href="project_structure.html" class="nav-link">ğŸ§­ Project Structure (DDD)</a>
            <a href="dependency.html" class="nav-link">ğŸ’‰ Dependency Injection</a>

            <div class="nav-section">Architecture Layers</div>
            <a href="domain.html" class="nav-link">ğŸ¯ Domain Layer</a>
            <a href="application.html" class="nav-link">âš™ï¸ Application Layer</a>
            <a href="infrastructure.html" class="nav-link active">ğŸ”§ Infrastructure Layer</a>
            <a href="presentation.html" class="nav-link">ğŸŒ Presentation Layer</a>
            <a href="middleware.html" class="nav-link">ğŸ”Œ Middleware</a>

            <div class="nav-section">Tactical DDD</div>
            <a href="aggregates.html" class="nav-link">ğŸ“¦ Aggregates</a>
            <a href="invariants.html" class="nav-link">ğŸ›¡ï¸ Invariants</a>
            <a href="repository_uow.html" class="nav-link">ğŸ—„ï¸ Repository & UoW</a>
            <a href="specification.html" class="nav-link">ğŸ“‹ Specification</a>
            <a href="domain_events.html" class="nav-link">ğŸ“£ Domain Events</a>
            <a href="policies.html" class="nav-link">ğŸ“œ Policies</a>
            <a href="versioning.html" class="nav-link">ğŸ”„ Versioning</a>

            <div class="nav-section">Strategic DDD</div>
            <a href="bounded_context.html" class="nav-link">ğŸŒ Bounded Contexts</a>
            <a href="ubiquitous_language.html" class="nav-link">ğŸ—£ï¸ Ubiquitous Language</a>
            <a href="context_relationships.html" class="nav-link">ğŸ¤ Context Relationships</a>
            <a href="acl.html" class="nav-link">ğŸ›¡ï¸ Anti-Corruption Layer</a>
            <a href="subdomains.html" class="nav-link">ğŸ§¬ Subdomains</a>
            <a href="modular_monolith.html" class="nav-link">ğŸ—ï¸ Modular Monolith</a>
            <a href="strategic_integration.html" class="nav-link">ğŸŒ Strategic Integration</a>
            <a href="big_ball_of_mud.html" class="nav-link">ğŸ· Big Ball of Mud</a>
            <a href="boundaries_first.html" class="nav-link">ğŸ§  Boundaries First</a>

            <div class="nav-section">CQRS and Distributed Systems</div>
            <a href="cqrs_es.html" class="nav-link">âš¡ CQRS and ES</a>
            <a href="saga.html" class="nav-link">ğŸ”„ Saga Pattern</a>
            <a href="outbox.html" class="nav-link">ğŸ“® Outbox Pattern</a>
            <a href="background_tasks.html" class="nav-link">â³ Background Tasks</a>
            <a href="observability.html" class="nav-link">ğŸ” Observability</a>

            <div class="nav-section">Reliability and Security</div>
            <a href="security.html" class="nav-link">ğŸ” Auth & Permissions</a>
            <a href="error_handling.html" class="nav-link">ğŸš« Error Handling</a>
            <a href="concurrency.html" class="nav-link">ğŸ›‘ Concurrency & Migrations</a>
            <a href="config_logging.html" class="nav-link">âš™ï¸ Config & Observability</a>

            <div class="nav-section">Quality and Practice</div>
            <a href="testing.html" class="nav-link">ğŸ§ª Testing</a>
            <a href="overengineering.html" class="nav-link">ğŸ›‘ Over-engineering</a>
            <a href="deployment.html" class="nav-link">ğŸš€ Deployment & Protection</a>
            <a href="frameworks_django.html" class="nav-link">ğŸ Django & Others</a>
            <a href="projects.html" class="nav-link">ğŸš€ Mini-Projects</a>
            <a href="antipatterns.html" class="nav-link">âš ï¸ Antipatterns</a>
            <a href="advanced_techniques.html" class="nav-link">ğŸš€ Advanced Tech</a>

            <div class="nav-section">About</div>
            <a href="afterword.html" class="nav-link">ğŸ‘‹ Afterword</a>
        </nav>
    </aside>

    <!-- CONTENT -->
    <main class="flex-1 md:ml-72 p-8 md:p-12 max-w-5xl mx-auto">
        
        <header id="intro" class="mb-12 pb-6 border-b border-gray-200">
            <div class="flex items-center gap-3 mb-2">
                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide">Layer 3</span>
                <span class="text-gray-400 text-sm font-mono">SQLAlchemy / Redis / Requests</span>
            </div>
            <h1 class="text-4xl font-extrabold text-gray-900 leading-tight">Infrastructure Layer</h1>
            <p class="text-xl text-gray-500 mt-4 font-light">
                Where abstractions meet reality. This is the only layer where <code>import sqlalchemy</code> is allowed.
            </p>
        </header>

        <!-- ANATOMY -->
        <section class="card">
            <h2 class="text-2xl font-bold mb-6">Layer Anatomy</h2>
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h3 class="flex items-center gap-2 font-bold text-blue-800 mb-4 border-b border-blue-200 pb-2 w-full">
                        âœ… MUST HAVE
                    </h3>
                    <ul class="space-y-4 text-sm">
                        <li class="flex items-start">
                            <span class="badge badge-blue mt-1">Impl</span>
                            <div><strong>Implementation:</strong> Interface implementations (`SqlAlchemyOrderRepository`, `SmtpEmailService`).</div>
                        </li>
                        <li class="flex items-start">
                            <span class="badge badge-blue mt-1">DB</span>
                            <div><strong>Database:</strong> ORM models, migrations (Alembic), sessions, raw SQL.</div>
                        </li>
                        <li class="flex items-start">
                            <span class="badge badge-blue mt-1">Ext</span>
                            <div><strong>External Tools:</strong> Clients for Redis, Kafka, Stripe, external APIs.</div>
                        </li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="flex items-center gap-2 font-bold text-red-800 mb-4 border-b border-red-200 pb-2 w-full">
                        â›” FORBIDDEN
                    </h3>
                    <ul class="space-y-4 text-sm">
                        <li class="flex items-start">
                            <span class="badge badge-red mt-1">Logic</span>
                            <div><strong>Business Rules:</strong> Don't validate invariants here ("can't create order with price < 0"). That's the Domain's responsibility.</div>
                        </li>
                        <li class="flex items-start">
                            <span class="badge badge-red mt-1">Flow</span>
                            <div><strong>Use Cases:</strong> Infrastructure shouldn't call other Use Cases. It's a "dumb executor".</div>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- DATA MAPPER -->
        <section id="mapper" class="mb-16">
            <h2 class="text-2xl font-bold mb-4">2. The Data Mapper Problem</h2>
            <p>The biggest pain point for beginners: <span class="font-bold bg-yellow-100 px-1">SQL Model != Domain Entity</span>.</p>
            <p><strong>Why can't we use an ORM model as an Entity?</strong></p>
            <ul class="list-disc pl-5 mb-4 text-sm">
                <li>ORM models are tied to the DB (ForeignKey, Integer).</li>
                <li>Domain entities are tied to business (Value Objects, logic).</li>
                <li>If you change the table structure, you shouldn't break business logic.</li>
            </ul>

            <p class="text-sm text-gray-600">
                In the example below, `OrderModel` is a <em>"dirty" model</em>, meaning it's a construct that DB libraries expect and understand. It stores simple `String`, `Float`, `JSON`, and because it's tied to infrastructure, we can change table structures without risking breaking business logic in the Domain Layer.
                The Domain Entity, on the other hand, stores Value Objects, invariants and behavior, and it lives independently from SQL.
            </p>

<pre><code class="language-python"><span class="code-comment"># infrastructure/db/models.py</span>
<span class="code-keyword">from</span> sqlalchemy <span class="code-keyword">import</span> Column, String, Float, Boolean, JSON
<span class="code-keyword">from</span> sqlalchemy.orm <span class="code-keyword">import</span> declarative_base

Base = declarative_base()

<span class="code-comment"># This is a "dirty" model for the DB</span>
<span class="code-keyword">class</span> <span class="code-class">OrderModel</span>(Base):
    __tablename__ = <span class="code-str">"orders"</span>
    
    id = Column(String, primary_key=<span class="code-keyword">True</span>)
    email = Column(String, index=<span class="code-keyword">True</span>) <span class="code-comment"># Just a string, not a VO</span>
    amount = Column(Float)             <span class="code-comment"># Just a number, not Money</span>
    currency = Column(String)
    items = Column(JSON)               <span class="code-comment"># JSON field instead of a table for simplicity</span>
    is_paid = Column(Boolean, default=<span class="code-keyword">False</span>)
</code></pre>
        </section>

        <!-- REPO VARIANTS -->
        <section id="repo" class="mb-16">
            <h2 class="text-2xl font-bold mb-6">3. Repository Pattern: 4 Implementations</h2>
            <p class="mb-6">A repository is a bridge. It takes an <strong>Entity</strong>, breaks it down, and puts it into an <strong>ORM Model</strong>. And vice versa.</p>

            <!-- VARIANT 1 -->
            <details>
                <summary>Variant 1: Simple CRUD (Without UoW)</summary>
                <div>
                    <p class="text-sm mb-4">Suitable for simple applications. Downside: `commit` happens inside the method, transactionality only within a single call.</p>
<pre><code class="language-python"><span class="code-keyword">from</span> domain.entities <span class="code-keyword">import</span> Order, Money, Email
<span class="code-keyword">from</span> application.interfaces <span class="code-keyword">import</span> OrderRepository
<span class="code-keyword">from</span> .models <span class="code-keyword">import</span> OrderModel

<span class="code-keyword">class</span> <span class="code-class">SqlAlchemyOrderRepository</span>(OrderRepository):
    <span class="code-keyword">def</span> <span class="code-func">__init__</span>(self, session):
        self.session = session

    <span class="code-keyword">def</span> <span class="code-func">save</span>(self, order: Order):
        <span class="code-comment"># 1. MAPPING: Domain -> DB Model</span>
        order_model = OrderModel(
            id=str(order.id),
            email=order.customer.value, <span class="code-comment"># Extract primitive from VO</span>
            amount=order.total_price.amount,
            currency=order.total_price.currency,
            items=[{<span class="code-str">'name'</span>: i[<span class="code-str">'name'</span>], <span class="code-str">'price'</span>: i[<span class="code-str">'price'</span>].amount} <span class="code-keyword">for</span> i <span class="code-keyword">in</span> order.items],
            is_paid=order.is_paid
        )
        
        <span class="code-comment"># 2. Upsert (Insert or Update)</span>
        self.session.merge(order_model)
        
        <span class="code-comment"># 3. Commit (Immediately)</span>
        self.session.commit()
</code></pre>
                </div>
            </details>

            <!-- VARIANT 2 -->
            <details>
                <summary>Variant 2: With Unit of Work Support (Recommended)</summary>
                <div>
                    <p class="text-sm mb-4">Here we do `flush()` instead of `commit()`. The UnitOfWork class will handle the commit. This allows you to modify an order and deduct a user's balance in <strong>one atomic transaction</strong>.</p>
                    <p class="text-sm text-gray-600">
                        UnitOfWork is an object that opens a transaction, passes one session to all repositories, and at the end does `commit()` or `rollback()` depending on the result. Variant 2 shows how the repository "puts" data and lets UoW decide when to commit everything. See the `SqlAlchemyUnitOfWork` implementation below â€” it creates `SqlAlchemyOrderRepository(self.session)` in `__enter__`, and the Use Case writes `with self.uow:` and calls `self.uow.orders.save(order)`; the commit happens automatically after exiting the block.
                    </p>
<pre><code class="language-python"><span class="code-keyword">class</span> <span class="code-class">SqlAlchemyOrderRepository</span>(OrderRepository):
    <span class="code-keyword">def</span> <span class="code-func">__init__</span>(self, session):
        self.session = session

    <span class="code-keyword">def</span> <span class="code-func">save</span>(self, order: Order):
        <span class="code-comment"># ... mapping (see above) ...</span>
        model = self._map_to_model(order)
        
        self.session.merge(model)
        self.session.flush() <span class="code-comment"># Send to DB, but wait for global commit</span>

    <span class="code-keyword">def</span> <span class="code-func">get_by_id</span>(self, oid) -> Order:
        model = self.session.query(OrderModel).get(str(oid))
        <span class="code-keyword">if</span> <span class="code-keyword">not</span> model:
            <span class="code-keyword">return</span> <span class="code-keyword">None</span>
        
        <span class="code-comment"># MAPPING: DB Model -> Domain Entity</span>
        <span class="code-comment"># Recreate objects. Important: don't call business logic here!</span>
        <span class="code-comment"># You can use a "dirty hack" or factory method.</span>
        order = Order(uuid.UUID(model.id), Email(model.email))
        
        <span class="code-comment"># Restore private state (Python allows this)</span>
        order._is_paid = model.is_paid
        <span class="code-comment"># ... restore items ...</span>
        
        <span class="code-keyword">return</span> order
</code></pre>
                </div>
            </details>

            <!-- VARIANT 3 -->
            <details>
                <summary>Variant 3: With Caching (Decorator Pattern)</summary>
                <div>
                    <p class="text-sm mb-4">We don't change the SQL repository code. We wrap it in a decorator. Open/Closed principle.</p>
                    <p class="text-sm text-gray-600">
                        A decorator is an object that implements the same interface as the decorated repository. It holds a reference to the original (`decoratee`) and delegates requests to it, adding its own steps before or after. In the example below, first comes saving to the DB, then the decorator invalidates the cache.
                    </p>
                    <p class="text-sm text-gray-600">
                        In a real application, `decoratee` is our Postgres repository (variant 2), and `CachedOrderRepository` simply wraps it. We preserve all operations to the main repository, and after that we flush and update the cache without rewriting the basic methods.
                    </p>
<pre><code class="language-python"><span class="code-keyword">import</span> json

<span class="code-keyword">class</span> <span class="code-class">CachedOrderRepository</span>(OrderRepository):
    <span class="code-keyword">def</span> <span class="code-func">__init__</span>(self, decoratee: OrderRepository, redis):
        self._decoratee = decoratee
        self._redis = redis

    <span class="code-keyword">def</span> <span class="code-func">get_by_id</span>(self, oid) -> Order:
        <span class="code-comment"># 1. Try to get from cache</span>
        cache_key = <span class="code-str">f"order:{oid}"</span>
        data = self._redis.get(cache_key)
        
        <span class="code-keyword">if</span> data:
            <span class="code-keyword">return</span> self._deserialize(json.loads(data))
        
        <span class="code-comment"># 2. If not - go to real DB</span>
        order = self._decoratee.get_by_id(oid)
        
        <span class="code-comment"># 3. Save to cache for 1 hour</span>
        <span class="code-keyword">if</span> order:
            self._redis.setex(cache_key, 3600, self._serialize(order))
            
        <span class="code-keyword">return</span> order

    <span class="code-keyword">def</span> <span class="code-func">save</span>(self, order: Order):
        <span class="code-comment"># First save to DB</span>
        self._decoratee.save(order)
        <span class="code-comment"># Invalidate cache (delete old value)</span>
        self._redis.delete(<span class="code-str">f"order:{order.id}"</span>)
</code></pre>
                </div>
            </details>

            <!-- VARIANT 4 -->
            <details>
                <summary>Variant 4: With Event Handling (Domain Events)</summary>
                <div>
                    <p class="text-sm mb-4">The repository (or UoW) collects events from the entity before saving.</p>
<pre><code class="language-python"><span class="code-keyword">class</span> <span class="code-class">EventDispatcherRepository</span>(OrderRepository):
    <span class="code-keyword">def</span> <span class="code-func">__init__</span>(self, decoratee: OrderRepository, bus):
        self._decoratee = decoratee
        self._bus = bus <span class="code-comment"># Message Bus</span>

    <span class="code-keyword">def</span> <span class="code-func">save</span>(self, order: Order):
        <span class="code-comment"># 1. Save data</span>
        self._decoratee.save(order)
        
        <span class="code-comment"># 2. Collect events (OrderPaid)</span>
        events = order.collect_events()
        
        <span class="code-comment"># 3. Send them to the event bus</span>
        <span class="code-keyword">for</span> event <span class="code-keyword">in</span> events:
            self._bus.publish(event)
</code></pre>
                </div>
            </details>
        </section>

        <!-- UNIT OF WORK -->
        <section id="uow" class="card bg-gray-50 border-gray-200">
            <h2 class="text-2xl font-bold mb-4">4. Unit of Work</h2>
            <p>A pattern for managing transactions. Guarantees that <strong>all or nothing</strong> will be saved.</p>
            
<pre><code class="language-python"><span class="code-keyword">class</span> <span class="code-class">SqlAlchemyUnitOfWork</span>:
    <span class="code-keyword">def</span> <span class="code-func">__init__</span>(self, session_factory):
        self.session_factory = session_factory

    <span class="code-keyword">def</span> <span class="code-func">__enter__</span>(self):
        <span class="code-comment"># Start transaction</span>
        self.session = self.session_factory()
        <span class="code-comment"># Initialize repositories with this session</span>
        self.orders = SqlAlchemyOrderRepository(self.session)
        <span class="code-keyword">return</span> self

    <span class="code-keyword">def</span> <span class="code-func">__exit__</span>(self, exc_type, exc_val, exc_tb):
        <span class="code-keyword">if</span> exc_type:
            self.session.rollback() <span class="code-comment"># Error? Rollback!</span>
        <span class="code-keyword">else</span>:
            self.session.commit() <span class="code-comment"># All good? Commit!</span>
        self.session.close()

<span class="code-comment"># Usage in UseCase:</span>
<span class="code-comment"># with self.uow:</span>
<span class="code-comment">#     self.uow.orders.save(order1)</span>
<span class="code-comment">#     self.uow.orders.save(order2)</span>
<span class="code-comment">#     # commit will happen automatically here</span>
</code></pre>
        </section>

        <!-- ADAPTERS -->
        <section id="adapters" class="mb-16">
            <h2 class="text-2xl font-bold mb-4">5. Adapters (External Services)</h2>
            <p>Here we implement interfaces like `EmailService`. We use real libraries.</p>

<pre><code class="language-python"><span class="code-comment"># infrastructure/adapters/email.py</span>
<span class="code-keyword">import</span> smtplib
<span class="code-keyword">from</span> email.mime.text <span class="code-keyword">import</span> MIMEText
<span class="code-keyword">from</span> application.interfaces <span class="code-keyword">import</span> EmailService

<span class="code-keyword">class</span> <span class="code-class">SmtpEmailAdapter</span>(EmailService):
    <span class="code-keyword">def</span> <span class="code-func">__init__</span>(self, host, port, user, password):
        self.host = host
        self.port = port
        <span class="code-comment"># ... credentials ...</span>

    <span class="code-keyword">def</span> <span class="code-func">send_order_confirmation</span>(self, email: str, order_id: str):
        msg = MIMEText(f<span class="code-str">"Your order {order_id} has been created!"</span>)
        msg[<span class="code-str">'Subject'</span>] = <span class="code-str">"Order created"</span>
        msg[<span class="code-str">'From'</span>] = <span class="code-str">"robot@shop.com"</span>
        msg[<span class="code-str">'To'</span>] = email

        <span class="code-comment"># Actual sending</span>
        <span class="code-keyword">with</span> smtplib.SMTP(self.host, self.port) <span class="code-keyword">as</span> server:
            server.login(...)
            server.send_message(msg)
</code></pre>
        </section>

        <!-- ANTIPATTERNS -->
        <section id="antipatterns">
            <h2 class="text-2xl font-bold text-red-700 mb-6">âš ï¸ Infrastructure Antipatterns</h2>
            
            <div class="space-y-4">
                <div class="p-4 border border-red-200 rounded bg-white">
                    <h3 class="font-bold text-red-800">1. God Repository</h3>
                    <p class="text-sm">A repository with methods like `calculate_stats()`, `send_email_to_users()`, `clean_old_logs()`. A repository should only: Save, Get, Delete, Find.</p>
                </div>
                
                <div class="p-4 border border-red-200 rounded bg-white">
                    <h3 class="font-bold text-red-800">2. Leaky Abstraction</h3>
                    <p class="text-sm">If your repository returns a `SQLAlchemy Model` object instead of a `Domain Entity`, you've tied your entire application to the database. If tomorrow you want to switch to MongoDB, you'll have to rewrite the entire application.</p>
                </div>
            </div>
        </section>

        <!-- NAVIGATION FOOTER -->
        <div class="mt-24 pt-10 border-t border-slate-200">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <a href="application.html" class="group border border-slate-300 rounded-xl p-4 w-full md:w-1/2 hover:border-blue-500 hover:shadow-md transition text-right bg-white">
                    <span class="block text-xs text-slate-400 font-bold uppercase tracking-wider mb-1 flex justify-end">Previous</span>
                    <span class="block text-lg font-bold text-slate-800 group-hover:text-blue-600 transition">&larr; âš™ï¸ Application Layer</span>
                </a>
                <a href="presentation.html" class="group border border-slate-300 rounded-xl p-4 w-full md:w-1/2 hover:border-blue-500 hover:shadow-md transition text-left bg-white">
                    <span class="block text-xs text-slate-400 font-bold uppercase tracking-wider mb-1">Next</span>
                    <span class="block text-lg font-bold text-slate-800 group-hover:text-blue-600 transition">ğŸŒ Presentation Layer &rarr;</span>
                </a>
            </div>
        </div>
    </main>
</body>
</html>